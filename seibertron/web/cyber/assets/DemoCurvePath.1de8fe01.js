import{S as oe,a as se,O as ae,V as M,W as le,b as ie,B as R,i as B,P as O,c as S,A as re,j as de,L as G,g as H,h as W,d as ce,E as ue,M as he,e as pe,C as fe,f as me}from"./three.e1deeef9.js";import{_ as ge}from"./interceptors.90732d07.js";import{a3 as we,e as x,d as j,i as ye,D as ve,o as be,c as Pe}from"./@vue.4c12bbe2.js";const xe={__name:"DemoCurvePath",props:{modelPath:{default:"",type:String},pathTable:{default:[],type:Array},addPoints:{default:{},type:Object},realPos:{default:{},type:Object},initHeight:{default:50,type:Number},showRealTimeVision:{type:Boolean,default:!1}},emits:["mapLoading"],setup(q,{emit:_}){const Z=q,{modelPath:N,pathTable:w,addPoints:A,realPos:U,initHeight:V,showRealTimeVision:z}=we(Z);let i=new oe,g=new se;const I=1280,T=720,k=I/T,y=30;let c=new ae(-y*k,y*k,y,-y,.01,5e3);c.position.set(0,0,V.value),c.up=new M(0,0,1),c.lookAt(0,0,0);let l=new le;l.setSize(I,T),l.setClearColor(17,.8);function J(){const e=new re(200);i.add(e)}J();const p=new ie(c,l.domElement);function K(e){const n=[];for(let o=0;o<e;o++){const t=o/(e-1),s=Math.sin(t*Math.PI*2)*.5+.5,a=Math.sin(t*Math.PI*2+Math.PI*2/3)*.5+.5,r=Math.sin(t*Math.PI*2+Math.PI*4/3)*.5+.5;n.push(new fe(s,a,r))}return n}(e=>{const n=new de;_("mapLoading",!0),n.load(e,o=>{w.value.length>0&&D(w.value);const t=o.geometry.attributes.position.array,s=t.length/3;let a=1/0,r=-1/0;for(let u=2;u<t.length;u+=3){const m=t[u];m<a&&(a=m),m>r&&(r=m)}const d=K(256),P=new Float32Array(s*3);for(let u=0;u<s;u++){const m=t[u*3+2],ne=Math.floor((m-a)/(r-a)*255),E=d[ne];P[u*3]=E.r,P[u*3+1]=E.g,P[u*3+2]=E.b}const L=new R;L.setAttribute("position",new B(t,3)),L.setAttribute("color",new B(P,3));const ee=new O({size:1,vertexColors:!0}),te=new S(L,ee);i.add(te),_("mapLoading",!1)},void 0,o=>{_("mapLoading",!1)})})(N.value);let v=[];const D=(e,n="blue")=>{if(!e||e.length===0)return;v.length>0&&(v.forEach(t=>{t.parent?t.parent.remove(t):i.remove(t)}),v=[]);const o=new G({color:n==="blue"?"#1E90FF":n,linewidth:3,dashed:!1});for(let t=0;t<e.length-1;t++){let s=new H;const a=[e[t].x,e[t].y,e[t].z],r=[e[t+1].x,e[t+1].y,e[t+1].z];let d=new W(s,o);d.visible=!0,s.setPositions([...a,...r]),d.computeLineDistances(),i.add(d),v.push(d)}};x(w,(e,n)=>{D(w.value)},{deep:!0});const C=j(null);ye(()=>{C.value.appendChild(l.domElement),document.body.appendChild(g.domElement)});const b=j([]);x(A,(e,n)=>{n.time!==e.time&&Q([...A.value.points.flat(1)])},{deep:!0});const Q=e=>{b.value.length>0&&(b.value.forEach(s=>{s.parent?s.parent.remove(s):i.remove(s)}),b.value=[]);const n=new R;n.attributes.position=new B(new Float32Array(e),3);const o=new O({color:16711680,size:1}),t=new S(n,o);i.add(t),b.value.push(t)},X=(e,n="blue")=>{if(!e||e.length===0)return;const o=new G({color:n==="blue"?"#1E90FF":n,linewidth:5,dashed:!1,resolution:new me(window.innerWidth,window.innerHeight)});for(let t=0;t<e.length-1;t++){let s=new H;const a=[e[t].x,e[t].y,e[t].z],r=[e[t+1].x,e[t+1].y,e[t+1].z];let d=new W(s,o);d.visible=!0,s.setPositions([...a,...r]),d.computeLineDistances(),d.renderOrder=98,i.add(d)}};let f=[];const Y=(e,{a:n,b:o,c:t,w:s})=>{f.push({x:e[0],y:e[1],z:e[2]}),f.length>2&&X([f[f.length-2],f[f.length-1]],"pink"),h.position.set(e[0],e[1],e[2]);const a=Math.sqrt(n*n+o*o+t*t+s*s);h.quaternion.set(n/a,o/a,t/a,s/a)};let h=null;function $(){const t=new ce;t.moveTo(-.5/2,-.5/2),t.lineTo(-.5/2,.5/2),t.lineTo(1/2,0),t.closePath();const s={steps:1,depth:.2,bevelEnabled:!1},a=new ue(t,s),r=new he({color:16711680,wireframe:!1,depthTest:!1});h=new pe(a,r),h.material.depthTest=!1,h.renderOrder=99,i.add(h)}$(),x(U,(e,n)=>{n.time!==e.time&&Y([e.x,e.y,e.z],{a:e.a,b:e.b,c:e.c,w:e.w})},{deep:!0}),x(z,(e,n)=>{if(!e){const o=h.position.clone();c.position.copy(o).add(new M(0,1,20)),c.lookAt(o),p.target=o,p.update()}});const F=()=>{if(!!l){if(z.value){p.enableRotate=!1,p.enablePan=!1;const e=h.position.clone();c.position.copy(e).add(new M(0,1,20)),c.lookAt(e)}else p.enableRotate=!0,p.enablePan=!0;g.update(),l.render(i,c),requestAnimationFrame(F)}};return F(),ve(()=>{try{g.domElement.style.display="none",document.body.removeChild(g.dom),g=null,C.value.removeChild(l.domElement),l.dispose(),l.forceContextLoss(),l.content=null;let e=l.domElement.getContext("webgl");e&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),l=null,c=null,i.traverse(n=>{n.material&&n.material.dispose(),n.geometry&&n.geometry.dispose(),n=null}),i=null}catch{}}),(e,n)=>(be(),Pe("div",{id:"content-3d",ref_key:"content3d",ref:C,class:"content-3d"},null,512))}};var Me=ge(xe,[["__scopeId","data-v-561b31da"]]);export{Me as D};
