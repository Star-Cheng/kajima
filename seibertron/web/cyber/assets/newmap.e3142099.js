import{l as X,y as K,A as Y,m as Z,B as ee,t as te}from"./element-plus.e290ba2a.js";import{m as oe,b as ae,c as se}from"./index.788e6f03.js";import{S as ne,a as le,O as ie,V as H,W as re,b as pe,B as me,F as q,P as ue,c as ce,A as de,C as fe,d as ge,E as ve,M as he,e as _e,L as we,f as be,g as ye,h as xe}from"./three.e1deeef9.js";import{_ as J,u as I}from"./interceptors.90732d07.js";import{a3 as Ce,d as h,i as Pe,e as j,D as Q,o as O,c as U,a as E,X as f,Q as g,V as P,W as x,u as v,F as Me,a7 as Se,P as Ee}from"./@vue.4c12bbe2.js";import{u as ke}from"./vue-router.55dd1a6d.js";import{u as Be}from"./user.207c9424.js";import{u as Ve}from"./vue-i18n.2d84f32f.js";import"./lodash-es.032e1c7e.js";import"./@vueuse.1d2bc008.js";import"./@element-plus.b6c25ca8.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./dayjs.8aab90e5.js";import"./axios.095b39ac.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./@floating-ui.cba15af0.js";import"./index.bf5881c5.js";import"./qs.d8de42ab.js";import"./side-channel.883eaff8.js";import"./get-intrinsic.89e72507.js";import"./has-symbols.caae0f97.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.b701f999.js";import"./object-inspect.3f4be82e.js";import"./index.ce62f2bc.js";import"./pinia.a87941f6.js";import"./vue-demi.b3a9cad9.js";import"./vue-echarts.df751a34.js";import"./resize-detector.4e96b72b.js";import"./echarts.3b66cafe.js";import"./zrender.d16352cb.js";import"./tslib.f5899810.js";import"./js-cookie.31874410.js";import"./nprogress.6825e71e.js";import"./yup.55b5a8e6.js";import"./nanoclone.7d3cb5fe.js";import"./lodash.46ddd8ff.js";import"./property-expr.48609aa3.js";import"./toposort.ef497e49.js";import"./@intlify.7ce2fd17.js";import"./user.8525e86f.js";const Le={__name:"DemoCurve",props:{addPoints:{type:Object,default:{}},realPos:{type:Object,default:{}},showRealTimeVision:{type:Boolean,default:!1}},emits:["loading","curCount"],setup($,{emit:s}){const D=$,{addPoints:k,realPos:z,showRealTimeVision:w}=Ce(D);let c=new ne,b=new le;const C=1600,T=720,M=C/T,B=30;let d=new ie(-B*M,B*M,B,-B,1,5e3);d.position.set(0,0,50),d.up=new H(0,0,1),d.lookAt(0,0,0);let m=new re;m.setSize(C,T),m.setClearColor(17,.8);function F(){const e=new de(200);c.add(e)}F();let y=new pe(d,m.domElement);const V=h(null);Pe(()=>{V.value.appendChild(m.domElement),document.body.appendChild(b.domElement)}),j(k,(e,o)=>{o.time!==e.time&&N([...k.value.points.flat(1)])},{deep:!0});function i(e){const o=[];for(let l=0;l<e;l++){const a=l/(e-1),u=Math.sin(a*Math.PI*2)*.5+.5,t=Math.sin(a*Math.PI*2+Math.PI*2/3)*.5+.5,S=Math.sin(a*Math.PI*2+Math.PI*4/3)*.5+.5;o.push(new fe(u,t,S))}return o}const R=i(256),N=e=>{const o=new me,l=[];for(let t=0;t<e.length;t+=3){const S=e[t+2],L=Math.floor(S/(20/R.length));let A=R[L];A||(A=R[0]),l.push(A.r,A.g,A.b)}o.setAttribute("position",new q(e,3)),o.setAttribute("color",new q(l,3));const a=new ue({vertexColors:!0,size:1}),u=new ce(o,a);c.add(u)},W=(e,o="blue")=>{if(!e||e.length===0)return;const l=new we({color:o==="blue"?"#1E90FF":o,linewidth:5,dashed:!1,resolution:new be(window.innerWidth,window.innerHeight)});for(let a=0;a<e.length-1;a++){let u=new ye;const t=[e[a].x,e[a].y,e[a].z],S=[e[a+1].x,e[a+1].y,e[a+1].z];let L=new xe(u,l);L.visible=!0,u.setPositions([...t,...S]),L.computeLineDistances(),L.renderOrder=98,c.add(L)}};let _=[];const G=(e,{a:o,b:l,c:a,w:u})=>{_.push({x:e[0],y:e[1],z:e[2]}),_.length>2&&W([_[_.length-2],_[_.length-1]],"pink"),n.position.set(e[0],e[1],e[2]);const t=Math.sqrt(o*o+l*l+a*a+u*u);n.quaternion.set(o/t,l/t,a/t,u/t)};let n=null;function r(){const a=new ge;a.moveTo(-.5/2,-.5/2),a.lineTo(-.5/2,.5/2),a.lineTo(1/2,0),a.closePath();const u={steps:1,depth:.2,bevelEnabled:!1},t=new ve(a,u),S=new he({color:16711680,wireframe:!1,depthTest:!1});n=new _e(t,S),n.material.depthTest=!1,n.renderOrder=99,c.add(n)}r(),j(z,(e,o)=>{o.time!==e.time&&G([e.x,e.y,e.z],{a:e.a,b:e.b,c:e.c,w:e.w})},{deep:!0}),j(w,(e,o)=>{if(!e){const l=n.position.clone();d.position.copy(l).add(new H(0,1,20)),d.lookAt(l),y.target=l,y.update()}});const p=()=>{if(!!m){if(w.value){y.enableRotate=!1,y.enablePan=!1;const e=n.position.clone();d.position.copy(e).add(new H(0,1,20)),d.lookAt(e)}else y.enableRotate=!0,y.enablePan=!0;b.update(),m.render(c,d),requestAnimationFrame(p)}};return p(),Q(()=>{try{b.domElement.style.display="none",document.body.removeChild(b.dom),b=null,V.value.removeChild(m.domElement),m.dispose(),m.forceContextLoss(),m.content=null;let e=m.domElement.getContext("webgl");e&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),m=null,d=null,c.traverse(o=>{o.material&&o.material.dispose(),o.geometry&&o.geometry.dispose(),o=null}),c=null}catch{}}),(e,o)=>(O(),U("div",{id:"content-3d",ref_key:"content3d",ref:V,class:"content-3d"},null,512))}};var Ie=J(Le,[["__scopeId","data-v-f04cf52e"]]);const Te={class:"relative w-full h-full"},Re={class:"m-[20px] p-[8px] absolute",style:{height:"calc(100% - 30px)","background-color":"#1a1d1f",width:"calc(100% - 30px)","border-radius":"10px"}},Ae={class:"p-[20px] flex items-center"},Oe={class:"map flex"},De={class:"dialog-footer"},ze={class:"flex items-center"},Fe={style:{"margin-right":"40px"}},Ne={class:"dialog-footer"},We={__name:"newmap",setup($){const{t:s}=Ve();Be(),ke();const D="ws://"+window.location.host.split(":")[0]+":8765",k=h(window.sessionStorage.getItem("currentMap")?JSON.parse(window.sessionStorage.getItem("currentMap")):null),z=h(window.sessionStorage.getItem("mapList")?JSON.parse(window.sessionStorage.getItem("mapList")):[]),w=h(!1),c=h(!1),b=h(!1),C=h(!1),T=h(20),M=h(!1),B=()=>{d()},d=async()=>{M.value=!1,C.value=!0,w.value?oe().then(n=>{i&&(i==null||i.close()),w.value=!1,b.value=!0,I("success",s("page.map.newmap.stop"))}).finally(()=>{C.value=!1}):ae().then(n=>{R(!0),b.value=!1}).catch(n=>{I("error",s("page.path.connectErr"))})},m=()=>{c.value=!0},F=()=>{se({id:k.value}).then(n=>{n.code==200&&(I("success",s("page.path.saveSuccess")),c.value=!1)}).catch(n=>{I("error",s("page.path.saveError"))})},y=h([]),V=h({});let i=null;const R=(n=!1)=>{if(i&&n)i==null||i.close();else if(i&&!n)return;i=new WebSocket(D),i.onopen=()=>{C.value=!1,w.value=!0,I("success",s("page.map.newmap"))},i.onerror=()=>{C.value=!1,w.value=!1,I("error",s("page.path.connectErr"))},i.onmessage=r=>{const p=JSON.parse(r.data);!p||(p.type==="lidar"?y.value={...p,time:new Date().getTime()}:p.type==="odom"&&(V.value={...p,time:new Date().getTime()}))}};Q(()=>{i&&(i==null||i.close())});const N=h(0),W=n=>{N.value=n},_=h(!1),G=()=>{_.value=!_.value};return(n,r)=>{const p=X,e=K,o=Y,l=Z,a=ee,u=te;return O(),U("div",Te,[E("div",Re,[f(u,null,{default:g(()=>[E("div",Ae,[f(p,{type:w.value?"danger":"primary",onClick:r[0]||(r[0]=t=>B()),loading:C.value},{default:g(()=>[P(x(w.value?v(s)("page.map.newmap.stop"):v(s)("page.map.newmap")),1)]),_:1},8,["type","loading"]),f(p,{type:"primary",onClick:m,disabled:!b.value},{default:g(()=>[P(x(v(s)("page.map.newmap.save")),1)]),_:1},8,["disabled"])]),E("div",Oe,[f(p,{type:_.value?"danger":"primary",style:{position:"absolute",right:"200px",bottom:"20px"},onClick:G,icon:"Refresh"},{default:g(()=>[P(x(_.value?v(s)("page.map.followCarStop"):v(s)("page.map.followCar")),1)]),_:1},8,["type"]),f(Ie,{style:{border:"1px solid #fff"},addPoints:y.value,realPos:V.value,onCurCount:W,showRealTimeVision:_.value},null,8,["addPoints","realPos","showRealTimeVision"])]),f(l,{modelValue:c.value,"onUpdate:modelValue":r[3]||(r[3]=t=>c.value=t),title:v(s)("page.map.newmap.save"),width:500},{footer:g(()=>[E("div",De,[f(p,{onClick:r[2]||(r[2]=t=>c.value=!1)},{default:g(()=>[P(x(v(s)("msg.universal.cancel")),1)]),_:1}),f(p,{type:"primary",onClick:F},{default:g(()=>[P(x(v(s)("msg.universal.confirm")),1)]),_:1})])]),default:g(()=>[P(x(v(s)("page.map.newmap.save.toast"))+"\uFF1A ",1),f(o,{modelValue:k.value,"onUpdate:modelValue":r[1]||(r[1]=t=>k.value=t)},{default:g(()=>[(O(!0),U(Me,null,Se(z.value,t=>(O(),Ee(e,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),f(l,{modelValue:M.value,"onUpdate:modelValue":r[6]||(r[6]=t=>M.value=t),title:v(s)("page.map.height"),width:500},{footer:g(()=>[E("div",Ne,[f(p,{onClick:r[5]||(r[5]=t=>M.value=!1)},{default:g(()=>[P(x(v(s)("msg.universal.cancel")),1)]),_:1}),f(p,{type:"primary",onClick:d},{default:g(()=>[P(x(v(s)("msg.universal.confirm")),1)]),_:1})])]),default:g(()=>[E("div",ze,[E("span",Fe,x(v(s)("page.map.toast.mapheight"))+"(m)\uFF1A",1),f(a,{modelValue:T.value,"onUpdate:modelValue":r[4]||(r[4]=t=>T.value=t),min:1,max:100},null,8,["modelValue"])])]),_:1},8,["modelValue","title"])]),_:1})])])}}};var Rt=J(We,[["__scopeId","data-v-1a76b63a"]]);export{Rt as default};
