import{y as st,A as nt,l as lt,b as rt,C as pt,u as mt,B as ut,m as dt,t as ct,v as vt}from"./element-plus.e290ba2a.js";import{D as gt}from"./DemoCurvePath.1de8fe01.js";import{f as _t,c as D}from"./camera.390d631c.js";import{u as ft}from"./vue-router.55dd1a6d.js";import{u as ht}from"./user.207c9424.js";import{_ as xt,u as L}from"./interceptors.90732d07.js";import{g as yt,s as bt,b as wt}from"./path.a462f43f.js";import{g as Vt,s as Pt}from"./config.8dd2591f.js";import{u as St}from"./vue-i18n.2d84f32f.js";import{d as a,D as kt,c as w,a as s,X as l,Q as m,a4 as Ct,o as c,u as r,F as N,a7 as B,V as h,W as v,R as Et,P as V,U as H,aA as zt,aB as Mt,L as It}from"./@vue.4c12bbe2.js";import"./lodash-es.032e1c7e.js";import"./@vueuse.1d2bc008.js";import"./@element-plus.b6c25ca8.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./dayjs.8aab90e5.js";import"./axios.095b39ac.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./@floating-ui.cba15af0.js";import"./three.e1deeef9.js";import"./mpegts.js.730ccbc0.js";import"./index.bf5881c5.js";import"./index.ce62f2bc.js";import"./pinia.a87941f6.js";import"./vue-demi.b3a9cad9.js";import"./vue-echarts.df751a34.js";import"./resize-detector.4e96b72b.js";import"./echarts.3b66cafe.js";import"./zrender.d16352cb.js";import"./tslib.f5899810.js";import"./js-cookie.31874410.js";import"./nprogress.6825e71e.js";import"./yup.55b5a8e6.js";import"./nanoclone.7d3cb5fe.js";import"./lodash.46ddd8ff.js";import"./property-expr.48609aa3.js";import"./toposort.ef497e49.js";import"./@intlify.7ce2fd17.js";import"./user.8525e86f.js";import"./qs.d8de42ab.js";import"./side-channel.883eaff8.js";import"./get-intrinsic.89e72507.js";import"./has-symbols.caae0f97.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.b701f999.js";import"./object-inspect.3f4be82e.js";const Tt=x=>(zt("data-v-ba39f164"),x=x(),Mt(),x),Dt={class:"relative w-full h-full"},Lt={class:"m-[20px] p-[8px] absolute",style:{height:"calc(100% - 30px)","background-color":"#1a1d1f",width:"calc(100% - 30px)","border-radius":"10px"}},Nt={class:"p-[20px] flex items-center"},Bt={class:"ml-[20px]"},Ht={class:"map flex"},Rt={style:{width:"1282px",height:"722px",border:"1px solid #fff",position:"relative"}},Ut={class:"map-info"},Ot={class:"video"},$t={class:"btn-box"},Jt={class:"misson flex items-center"},Wt={style:{"margin-right":"10px",width:"150px"}},At={class:"misson flex items-center"},Ft={style:{"margin-right":"10px",width:"150px"}},jt=Tt(()=>s("div",{class:"vslam"},null,-1)),Kt={class:"flex items-center"},Qt={style:{"margin-right":"40px"}},Xt={class:"dialog-footer"},qt={__name:"navigation",setup(x){const{t:i}=St();ht();const R=a(!1);ft();const U=R.value?"ws://localhost:8765":"ws://"+window.location.host.split(":")[0]+":8765",y=a(window.sessionStorage.getItem("currentMap")?JSON.parse(window.sessionStorage.getItem("currentMap")):null),P=a(window.sessionStorage.getItem("mapList")?JSON.parse(window.sessionStorage.getItem("mapList")):[]);P.value=P.value.filter(o=>o.type===2);const g=a([]),E=a(!1),S=a(""),z=a(0),k=a(50),_=a(!1),u=a({running:!1,time:["00:00:00","23:59:59"]}),C=a(!1);(()=>{Vt().then(o=>{u.value={...o.data.data,running:o.data.running==="1",time:[o.data.start_time,o.data.end_time]}}).finally(()=>{showSwitch.value=!0})})();const O=()=>{C.value=!0,Pt({start_time:u.value.time[0],end_time:u.value.time[1],running:u.value.running?"1":"0"}).then(o=>{L("success",i("page.path.saveSuccess"))}).catch(o=>{L("error",i("page.path.saveError")),u.value.running=!u.value.running}).finally(()=>{C.value=!1})},$=()=>{_.value=!1,S.value="/hms/map/get_map?id="+y.value,z.value++,E.value=!0,yt({id:y.value}).then(o=>{g.value=o.data.data.map(n=>{var b,d;return{...n,z:(b=n.z)!=null?b:0,pos:[n.x,n.y,(d=n.z)!=null?d:0]}});const t=g.value[g.value.length-1];(g.value.length===0||!(t.x==0&&t.y==0&&t.z==0))&&g.value.push({tag:"normal",pos:[0,0,0],x:0,y:0,z:0}),W(!0),bt()})},J=()=>{},M=a({}),I=a({});let p=null;const W=(o=!1)=>{if(p&&o)p==null||p.close();else if(p&&!o)return;p=new WebSocket(U),p.onopen=()=>{},p.onmessage=t=>{const n=JSON.parse(t.data);!n||(n.type==="lidar"?M.value={...n,time:new Date().getTime()}:n.type==="odom"&&(I.value={...n,time:new Date().getTime()}))}},f=a(!1),A=()=>{f.value=!f.value};kt(()=>{p&&(wt(),p==null||p.close())});const F=a([{ptzEnum:5,position:[5,10],positionPercent:[5,15],rotate:-135,x:"-1",y:"1"},{ptzEnum:1,position:[250,10],positionPercent:[50,15],rotate:-90,x:"0",y:"1"},{ptzEnum:7,position:[500,10],positionPercent:[95,15],rotate:-45,x:"1",y:"1"},{ptzEnum:3,position:[-5,130],positionPercent:[5,50],rotate:-180,x:"-1",y:"0"},{ptzEnum:4,position:[500,130],positionPercent:[95,50],rotate:0,x:"1",y:"0"},{ptzEnum:6,position:[-5,260],positionPercent:[5,85],rotate:135,x:"-1",y:"-1"},{ptzEnum:2,position:[250,260],positionPercent:[50,85],rotate:90,x:"0",y:"-1"},{ptzEnum:8,position:[500,260],positionPercent:[95,85],rotate:45,x:"1",y:"-1"}]),j=o=>{D({x:o.x,y:o.y})},K=()=>{D({x:"0",y:"0"})},T=a(!1),Q=o=>{T.value=o};return(o,t)=>{const n=st,b=nt,d=lt,X=Ct("CaretRight"),q=rt,G=pt,Y=mt,Z=ut,tt=dt,et=ct,ot=vt;return c(),w("div",Dt,[s("div",Lt,[l(et,null,{default:m(()=>[s("div",Nt,[l(b,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),placeholder:r(i)("page.map.select"),style:{width:"240px"}},{default:m(()=>[(c(!0),w(N,null,B(P.value,e=>(c(),V(n,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),s("div",Bt,[l(d,{type:"primary",onClick:t[1]||(t[1]=e=>_.value=!0)},{default:m(()=>[h(v(r(i)("page.navigation.import")),1)]),_:1}),l(d,{type:"primary",onClick:J},{default:m(()=>[h(v(r(i)("page.navigation.start")),1)]),_:1})])]),s("div",Ht,[Et((c(),w("div",Rt,[E.value?(c(),V(gt,{modelPath:S.value,pathTable:g.value,key:z.value,addPoints:M.value,realPos:I.value,showRealTimeVision:f.value,onMapLoading:Q,initHeight:k.value},null,8,["modelPath","pathTable","addPoints","realPos","showRealTimeVision","initHeight"])):H("",!0),S.value.length>0?(c(),V(d,{key:1,type:f.value?"danger":"primary",style:{position:"absolute",right:"100px",bottom:"20px"},onClick:A,icon:"Refresh"},{default:m(()=>[h(v(f.value?r(i)("page.map.followCarStop"):r(i)("page.map.followCar")),1)]),_:1},8,["type"])):H("",!0)])),[[ot,T.value]]),s("div",Ut,[s("div",Ot,[s("div",$t,[(c(!0),w(N,null,B(F.value,(e,at)=>(c(),V(d,{circle:"",key:at,class:"operate-btn",style:It({transform:"rotate("+e.rotate+"deg)",left:e.position[0]+"px",top:e.position[1]+"px"}),onMousedown:it=>j(e),onMouseup:it=>K()},{default:m(()=>[l(q,null,{default:m(()=>[l(X)]),_:1})]),_:2},1032,["style","onMousedown","onMouseup"]))),128))]),l(_t,{style:{width:"550px",height:"309px"},videoId:"video",url:"/hms/camera/stream",isPlay:!0})]),s("div",Jt,[s("span",Wt,v(r(i)("page.navigation.mission.title")),1),l(G,{modelValue:u.value.time,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value.time=e),"is-range":"",format:"HH:mm:ss","value-format":"HH:mm:ss",clearable:!1},null,8,["modelValue"])]),s("div",At,[s("span",Ft,v(r(i)("page.navigation.mission.title.status")),1),l(Y,{modelValue:u.value.running,"onUpdate:modelValue":t[3]||(t[3]=e=>u.value.running=e),"active-text":r(i)("page.navigation.mission.title.start"),"inactive-text":r(i)("page.navigation.mission.title.stop"),loading:C.value,onChange:O},null,8,["modelValue","active-text","inactive-text","loading"])]),jt])]),l(tt,{modelValue:_.value,"onUpdate:modelValue":t[6]||(t[6]=e=>_.value=e),title:r(i)("page.map.height"),width:500},{footer:m(()=>[s("div",Xt,[l(d,{onClick:t[5]||(t[5]=e=>_.value=!1)},{default:m(()=>[h(v(r(i)("msg.universal.cancel")),1)]),_:1}),l(d,{type:"primary",onClick:$},{default:m(()=>[h(v(r(i)("msg.universal.confirm")),1)]),_:1})])]),default:m(()=>[s("div",Kt,[s("span",Qt,v(r(i)("page.map.toast.mapheight"))+"(m)\uFF1A",1),l(Z,{modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=e=>k.value=e),min:20,max:100},null,8,["modelValue"])])]),_:1},8,["modelValue","title"])]),_:1})])])}}};var Qe=xt(qt,[["__scopeId","data-v-ba39f164"]]);export{Qe as default};
