import{y as K,A as Q,l as Y,w as Z,x as q,B as G,m as ee,t as ae,v as te}from"./element-plus.e290ba2a.js";import{D as oe}from"./DemoCurvePath.1de8fe01.js";import{u as le}from"./vue-router.55dd1a6d.js";import{u as se}from"./user.207c9424.js";import{_ as ne,u as N}from"./interceptors.90732d07.js";import{g as ie,s as pe,a as re,b as ue}from"./path.a462f43f.js";import{u as me}from"./vue-i18n.2d84f32f.js";import{d as u,D as de,c as S,a as m,X as p,Q as n,o as g,W as c,u as i,F as ce,a7 as ve,V as _,R as ge,P as b,U as I}from"./@vue.4c12bbe2.js";import"./lodash-es.032e1c7e.js";import"./@vueuse.1d2bc008.js";import"./@element-plus.b6c25ca8.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./dayjs.8aab90e5.js";import"./axios.095b39ac.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./@floating-ui.cba15af0.js";import"./three.e1deeef9.js";import"./index.bf5881c5.js";import"./index.ce62f2bc.js";import"./pinia.a87941f6.js";import"./vue-demi.b3a9cad9.js";import"./vue-echarts.df751a34.js";import"./resize-detector.4e96b72b.js";import"./echarts.3b66cafe.js";import"./zrender.d16352cb.js";import"./tslib.f5899810.js";import"./js-cookie.31874410.js";import"./nprogress.6825e71e.js";import"./yup.55b5a8e6.js";import"./nanoclone.7d3cb5fe.js";import"./lodash.46ddd8ff.js";import"./property-expr.48609aa3.js";import"./toposort.ef497e49.js";import"./@intlify.7ce2fd17.js";import"./user.8525e86f.js";import"./qs.d8de42ab.js";import"./side-channel.883eaff8.js";import"./get-intrinsic.89e72507.js";import"./has-symbols.caae0f97.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.b701f999.js";import"./object-inspect.3f4be82e.js";const _e={class:"relative w-full h-full"},fe={class:"m-[20px] p-[8px] absolute",style:{height:"calc(100% - 30px)","background-color":"#1a1d1f",width:"calc(100% - 30px)","border-radius":"10px"}},he={class:"px-[20px] py-[18px] flex items-center justify-between"},xe={class:"text-[24px]"},ye={class:"map flex"},be={style:{width:"1282px",height:"722px",border:"1px solid #fff",position:"relative"}},we={class:"map-info"},Ve={class:"flex justify-between"},ke={class:"flex items-center"},Ce={style:{"margin-right":"40px"}},Se={class:"dialog-footer"},Pe={__name:"pathplan",setup(ze){var D,L;const{t}=me();se(),le();const M="ws://"+window.location.host.split(":")[0]+":8765",f=u();f.value=window.sessionStorage.getItem("currentMap")&&(D=JSON.parse(window.sessionStorage.getItem("currentMap")))!=null?D:null;const w=u(window.sessionStorage.getItem("mapList")?(L=JSON.parse(window.sessionStorage.getItem("mapList")))!=null?L:[]:[]);w.value=w.value.filter(e=>e.type!==0);const o=u([]),P=u(!1),V=u(""),z=u(0),k=u(50),h=u(!1),B=()=>{h.value=!1,V.value="/hms/map/get_map?id="+f.value,z.value++,P.value=!0,ie({id:f.value}).then(e=>{o.value=e.data.data.map(a=>{var d,y;return{...a,z:(d=a.z)!=null?d:0,pos:[a.x,a.y,(y=a.z)!=null?y:0]}}),o.value[o.value.length-1],o.value.length===0&&o.value.push({tag:"normal",pos:[0,0,0],x:0,y:0,z:0}),j(!0),pe()})},O=e=>{o.value.splice(o.value.indexOf(e),1)},R=()=>{re({id:f.value,path:o.value.map(e=>({tag:e.tag,x:e.pos[0],y:e.pos[1],z:e.pos[2]}))}).then(e=>{N("success",t("page.path.saveSuccess"))}).catch(e=>{N("error",t("page.path.saveError"))})},U=()=>{var a;const e=(a=o.value[o.value.length-1])!=null?a:null;e&&e.x==0&&e.y==0&&e.z==0?o.value.splice(o.value.length-1,0,{tag:"normal",pos:[s.value.x,s.value.y,s.value.z],x:s.value.x,y:s.value.y,z:s.value.z}):o.value.push({tag:"normal",pos:[s.value.x,s.value.y,s.value.z],x:s.value.x,y:s.value.y,z:s.value.z})},T=u({}),s=u({});let r=null;const j=(e=!1)=>{if(r&&e)r==null||r.close();else if(r&&!e)return;r=new WebSocket(M),r.onopen=()=>{},r.onmessage=a=>{const d=JSON.parse(a.data);!d||(d.type==="lidar"?T.value={...d,time:new Date().getTime()}:d.type==="odom"&&(s.value={...d,time:new Date().getTime()}))}},E=u(!1),H=e=>{E.value=e},x=u(!1),$=()=>{x.value=!x.value};return de(()=>{r&&(ue(),r==null||r.close())}),(e,a)=>{const d=K,y=Q,v=Y,C=Z,J=q,W=G,F=ee,X=ae,A=te;return g(),S("div",_e,[m("div",fe,[p(X,null,{default:n(()=>[m("div",he,[m("span",xe,c(i(t)("router.pathplan")),1),m("div",null,[p(y,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=l=>f.value=l),placeholder:i(t)("page.map.select"),style:{width:"240px"}},{default:n(()=>[(g(!0),S(ce,null,ve(w.value,l=>(g(),b(d,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),p(v,{type:"primary",onClick:a[1]||(a[1]=l=>h.value=!0),style:{"margin-left":"40px"}},{default:n(()=>[_(c(i(t)("page.map.import")),1)]),_:1})])]),m("div",ye,[ge((g(),S("div",be,[V.value.length>0?(g(),b(v,{key:0,type:x.value?"danger":"primary",style:{position:"absolute",right:"100px",bottom:"20px"},onClick:$,icon:"Refresh"},{default:n(()=>[_(c(x.value?i(t)("page.map.followCarStop"):i(t)("page.map.followCar")),1)]),_:1},8,["type"])):I("",!0),P.value?(g(),b(oe,{modelPath:V.value,pathTable:o.value,key:z.value,addPoints:T.value,realPos:s.value,onMapLoading:H,initHeight:k.value,showRealTimeVision:x.value},null,8,["modelPath","pathTable","addPoints","realPos","initHeight","showRealTimeVision"])):I("",!0)])),[[A,E.value]]),m("div",we,[m("div",Ve,[p(v,{type:"primary",onClick:U,class:"mb-[10px]"},{default:n(()=>[_(c(i(t)("page.path.addpoint")),1)]),_:1}),p(v,{type:"primary",class:"mb-[10px]",onClick:R},{default:n(()=>[_(c(i(t)("page.path.save")),1)]),_:1})]),p(J,{data:o.value,style:{width:"100%"},border:"",height:"650px"},{default:n(()=>[p(C,{type:"index",width:"150",label:i(t)("page.dashboard.index")},null,8,["label"]),p(C,{label:"XYZ"},{default:n(l=>[m("span",null,c(l.row.pos.toString()),1)]),_:1}),p(C,{label:i(t)("page.manager.common.action"),width:"200"},{default:n(l=>[(l.$index!=o.value.length-1,g(),b(v,{key:0,type:"danger",onClick:Te=>O(l.row)},{default:n(()=>[_(c(i(t)("page.manager.common.delete")),1)]),_:2},1032,["onClick"]))]),_:1},8,["label"])]),_:1},8,["data"])])]),p(F,{modelValue:h.value,"onUpdate:modelValue":a[4]||(a[4]=l=>h.value=l),title:i(t)("page.map.height"),width:500},{footer:n(()=>[m("div",Se,[p(v,{onClick:a[3]||(a[3]=l=>h.value=!1)},{default:n(()=>[_(c(i(t)("msg.universal.cancel")),1)]),_:1}),p(v,{type:"primary",onClick:B},{default:n(()=>[_(c(i(t)("msg.universal.confirm")),1)]),_:1})])]),default:n(()=>[m("div",ke,[m("span",Ce,c(i(t)("page.map.toast.mapheight"))+"(m)\uFF1A",1),p(W,{modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=l=>k.value=l),min:20,max:100},null,8,["modelValue"])])]),_:1},8,["modelValue","title"])]),_:1})])])}}};var Va=ne(Pe,[["__scopeId","data-v-80de8aa0"]]);export{Va as default};
